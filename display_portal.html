<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Queue Display | Ethiopia Queue Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: white;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .header .subtitle {
            font-size: 1.5em;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .now-serving-section {
            margin-bottom: 50px;
        }

        .section-title {
            font-size: 2em;
            color: #667eea;
            margin-bottom: 30px;
            text-align: center;
        }

        .serving-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .serving-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
            }
            50% {
                transform: scale(1.02);
                box-shadow: 0 15px 50px rgba(102, 126, 234, 0.5);
            }
        }

        .serving-card .label {
            font-size: 1.2em;
            opacity: 0.8;
            margin-bottom: 15px;
        }

        .serving-card .ticket-number {
            font-size: 5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .serving-card .counter {
            font-size: 2em;
            font-weight: bold;
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 10px;
            display: inline-block;
        }

        .stats-section {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin-bottom: 40px;
        }

        .stat-box {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .stat-box h3 {
            font-size: 3em;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-box p {
            font-size: 1.2em;
            opacity: 0.8;
        }

        .waiting-list {
            background: rgba(255,255,255,0.05);
            padding: 30px;
            border-radius: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .waiting-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .waiting-item .ticket {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .no-tickets {
            text-align: center;
            padding: 60px;
            font-size: 2em;
            color: rgba(255,255,255,0.5);
        }

        .time-display {
            text-align: center;
            font-size: 1.5em;
            color: rgba(255,255,255,0.7);
            margin-top: 30px;
        }

        .blink {
            animation: blink 1.5s linear infinite;
        }

        @keyframes blink {
            0%, 49% {
                opacity: 1;
            }
            50%, 100% {
                opacity: 0.3;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ETHIOPIA Queue Management System</h1>
        <p class="subtitle">Public Display - Please Wait for Your Number</p>
    </div>

    <div class="main-content">
        <div class="now-serving-section">
            <h2 class="section-title blink">NOW SERVING</h2>
            <div class="serving-grid" id="servingGrid">
                <div class="no-tickets">No one currently being served</div>
            </div>
        </div>

        <div class="stats-section">
            <div class="stat-box">
                <h3 id="waitingCount">-</h3>
                <p>People Waiting</p>
            </div>
            <div class="stat-box">
                <h3 id="servedToday">-</h3>
                <p>Served Today</p>
            </div>
            <div class="stat-box">
                <h3 id="avgWait">-</h3>
                <p>Average Wait (min)</p>
            </div>
        </div>

        <div class="time-display" id="timeDisplay"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';

        // Update time every second
        setInterval(updateTime, 1000);
        updateTime();

        // Refresh queue every 3 seconds
        setInterval(refreshDisplay, 3000);
        refreshDisplay();

        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            });
            const dateString = now.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('timeDisplay').textContent = `${dateString} - ${timeString}`;
        }

        async function refreshDisplay() {
            try {
                // Get queue status
                const queueResponse = await fetch(`${API_BASE}/api/display/queue-status`);
                const queueData = await queueResponse.json();

                // Get statistics
                const statsResponse = await fetch(`${API_BASE}/api/statistics`);
                const statsData = await statsResponse.json();

                updateServingDisplay(queueData.now_serving);
                updateStats(queueData, statsData);
            } catch (error) {
                console.error('Failed to refresh display:', error);
            }
        }

        function updateServingDisplay(nowServing) {
            const servingGrid = document.getElementById('servingGrid');

            // Debug: Log what we received from API
            console.log('Now Serving Data:', nowServing);

            if (!nowServing || nowServing.length === 0) {
                servingGrid.innerHTML = '<div class="no-tickets">No one currently being served</div>';
                return;
            }

            // Display each ticket with its counter
            let html = '';
            nowServing.forEach(ticket => {
                // Get counter number, default to 1 if not set
                const counterNum = ticket.counter_number || 1;

                console.log(`Ticket ${ticket.ticket_number} at Counter ${counterNum}`);

                html += `
                    <div class="serving-card">
                        <div class="label">TICKET NUMBER</div>
                        <div class="ticket-number">${ticket.ticket_number}</div>
                        <div class="counter">COUNTER ${counterNum}</div>
                    </div>
                `;
            });

            servingGrid.innerHTML = html;
        }

        function updateStats(queueData, statsData) {
            document.getElementById('waitingCount').textContent = queueData.waiting_count || 0;
            document.getElementById('servedToday').textContent = queueData.total_served_today || 0;

            const avgWait = statsData.average_service_time_minutes;
            document.getElementById('avgWait').textContent =
                avgWait > 0 ? Math.round(avgWait) : '-';
        }
    </script>
</body>
</html>

